services:
  nginx:
    extends:
      file: ./docker_compose/nginx.yml
      service: nginx
    volumes:
      - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./docker/nginx/conf.d:/etc/nginx/conf.d:ro
    depends_on:
      - auth_service
    ports:
      - "${APP__PORT}:80"

  auth_service:
    extends:
      file: ./docker_compose/auth_service.yml
      service: auth_service
    env_file:
      - ./.env
    expose:
      - "${UVICORN__PORT}"
    depends_on:
      redis:
        condition: service_healthy

  redis:
    extends:
      file: ./docker_compose/redis.yml
      service: redis
    expose:
      - "${REDIS__PORT}"
    volumes:
      - redis-storage:/data
    env_file:
      - ./.env

volumes:
  redis-storage:
